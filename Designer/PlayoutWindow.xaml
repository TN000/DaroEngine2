<!-- Designer/PlayoutWindow.xaml -->
<Window x:Class="DaroDesigner.PlayoutWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:DaroDesigner.Models"
        Title="DARO PLAYOUT"
        Height="800" Width="1400"
        MinHeight="600" MinWidth="1000"
        Background="{StaticResource BgMain}"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles/DarkTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="F1" Command="{Binding TakeCommand}"/>
        <KeyBinding Key="F2" Command="{Binding CueNextCommand}"/>
        <KeyBinding Key="F12" Command="{Binding ClearCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TOP BAR -->
        <Border Grid.Row="0" Background="{StaticResource BgHeader}" Padding="8,6">
            <DockPanel>
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <!-- Mode Switcher -->
                    <Border x:Name="BtnModeDesigner" Background="#FF3C3C3C" CornerRadius="3"
                            Padding="12,4" Margin="0,0,4,0" Cursor="Hand"
                            MouseLeftButtonDown="ModeDesigner_Click">
                        <TextBlock Text="Designer" Foreground="#CCCCCC" FontWeight="SemiBold"/>
                    </Border>
                    <Border x:Name="BtnModePlayout" Background="{StaticResource AccentBlue}" CornerRadius="3"
                            Padding="12,4" Margin="0,0,4,0" Cursor="Hand">
                        <TextBlock Text="Playout" Foreground="White" FontWeight="SemiBold"/>
                    </Border>
                    <Border x:Name="BtnModeTemplate" Background="#FF3C3C3C" CornerRadius="3"
                            Padding="12,4" Cursor="Hand"
                            MouseLeftButtonDown="ModeTemplate_Click">
                        <TextBlock Text="Template" Foreground="#CCCCCC" FontWeight="SemiBold"/>
                    </Border>
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="16,0"/>
                    <Button Content="Open Engine Window" Click="OpenEngineWindow_Click" Padding="12,4"/>
                    <Button x:Name="BtnMiddleware" Content="Start Middleware" Click="Middleware_Click" Padding="12,4" Margin="8,0,0,0"/>
                </StackPanel>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <TextBlock x:Name="TxtOnAirStatus" Text="OFF AIR" FontSize="12" FontWeight="Bold"
                               Foreground="{StaticResource FgSecondary}" VerticalAlignment="Center" Margin="0,0,16,0"/>
                    <Button x:Name="BtnClear" Content="CLEAR (F12)" Click="Clear_Click" Padding="12,4"
                            Background="{StaticResource StopColor}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button x:Name="BtnCueNext" Content="CUE NEXT (F2)" Click="CueNext_Click"
                            Padding="16,4" Margin="0,0,8,0"/>
                    <Button x:Name="BtnTake" Content="TAKE (F1)" Click="Take_Click"
                            Padding="24,4" FontWeight="Bold" FontSize="14"
                            Background="{StaticResource PlayColor}"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Grid.Row="1" Margin="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350" MinWidth="280"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT PANEL: Template Browser + Fill + Options -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" MinHeight="200"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="*" MinHeight="150"/>
                </Grid.RowDefinitions>

                <!-- TEMPLATES & FILL FORM -->
                <Border Grid.Row="0" Background="{StaticResource BgPanel}" Margin="0,0,0,2">
                    <DockPanel>
                        <!-- Templates Tree Header -->
                        <Border DockPanel.Dock="Top" Background="{StaticResource BgHeader}" Padding="8,6">
                            <DockPanel>
                                <TextBlock Text="TEMPLATES" Style="{StaticResource HeaderStyle}"/>
                                <Button DockPanel.Dock="Right" Content="âŸ³" Width="24" Height="24"
                                        Click="RefreshTemplates_Click" ToolTip="Refresh"/>
                            </DockPanel>
                        </Border>

                        <!-- Template Tree + Fill Form in TabControl -->
                        <TabControl Background="Transparent" BorderThickness="0">
                            <TabControl.Resources>
                                <Style TargetType="TabItem">
                                    <Setter Property="Background" Value="#FF2D2D30"/>
                                    <Setter Property="Foreground" Value="#CCCCCC"/>
                                    <Setter Property="Padding" Value="12,4"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TabItem">
                                                <Border x:Name="TabBorder" Background="{TemplateBinding Background}"
                                                        Padding="{TemplateBinding Padding}" Margin="0,0,2,0">
                                                    <ContentPresenter ContentSource="Header"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="TabBorder" Property="Background" Value="{StaticResource AccentBlue}"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TabControl.Resources>

                            <!-- Browse Tab -->
                            <TabItem Header="Browse">
                                <DockPanel>
                                    <Border DockPanel.Dock="Bottom" Padding="8">
                                        <StackPanel>
                                            <TextBlock x:Name="TxtSelectedTemplate" Text="No template selected"
                                                       Foreground="{StaticResource FgSecondary}" FontSize="11"
                                                       Margin="0,0,0,8" TextWrapping="Wrap"/>
                                            <Button x:Name="BtnLoadTemplate" Content="Load Template" Height="28"
                                                    Click="LoadTemplate_Click" IsEnabled="False"/>
                                        </StackPanel>
                                    </Border>
                                    <TreeView x:Name="TemplatesTree" Background="Transparent" BorderThickness="0"
                                              SelectedItemChanged="TemplatesTree_SelectedItemChanged" Margin="4">
                                        <TreeView.Resources>
                                            <HierarchicalDataTemplate DataType="{x:Type local:TemplateFolderModel}"
                                                                      ItemsSource="{Binding Children}">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="ðŸ“" Margin="0,0,6,0"/>
                                                    <TextBlock Text="{Binding Name}" Foreground="White"/>
                                                </StackPanel>
                                            </HierarchicalDataTemplate>
                                            <DataTemplate DataType="{x:Type local:TemplateItemModel}">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="ðŸ“„" Margin="0,0,6,0"/>
                                                    <TextBlock Text="{Binding Name}" Foreground="{StaticResource AccentBlue}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </TreeView.Resources>
                                        <TreeView.ItemContainerStyle>
                                            <Style TargetType="TreeViewItem">
                                                <Setter Property="Foreground" Value="White"/>
                                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                            </Style>
                                        </TreeView.ItemContainerStyle>
                                    </TreeView>
                                </DockPanel>
                            </TabItem>

                            <!-- Fill Tab -->
                            <TabItem Header="Fill Data" x:Name="TabFillData">
                                <DockPanel>
                                    <Border DockPanel.Dock="Top" Background="{StaticResource BgHeader}" Padding="8,4">
                                        <DockPanel>
                                            <TextBlock x:Name="TxtFillTemplateName" Text="No template loaded"
                                                       Foreground="White" FontWeight="SemiBold"/>
                                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                                                <Button Content="Clear" Click="ClearFillForm_Click"
                                                        Padding="8,2" Margin="0,0,4,0"/>
                                            </StackPanel>
                                        </DockPanel>
                                    </Border>
                                    <Border DockPanel.Dock="Bottom" Padding="8">
                                        <Button x:Name="BtnAddToPlaylist" Content="+ Add to Playlist" Height="32"
                                                Click="AddToPlaylist_Click" IsEnabled="False"
                                                Background="{StaticResource AccentBlue}"/>
                                    </Border>
                                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Margin="8">
                                        <Canvas x:Name="TemplateFillForm">
                                            <TextBlock Text="Load a template to fill data."
                                                       Foreground="{StaticResource FgSecondary}" FontSize="11"
                                                       Canvas.Left="0" Canvas.Top="0"/>
                                        </Canvas>
                                    </ScrollViewer>
                                </DockPanel>
                            </TabItem>
                        </TabControl>
                    </DockPanel>
                </Border>

                <!-- Splitter -->
                <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch"
                              Background="{StaticResource BorderDark}" Cursor="SizeNS"/>

                <!-- OPTIONS TABS -->
                <Border Grid.Row="2" Background="{StaticResource BgPanel}" Margin="0,2,0,0">
                    <TabControl Background="Transparent" BorderThickness="0">
                        <TabControl.Resources>
                            <Style TargetType="TabItem">
                                <Setter Property="Background" Value="#FF2D2D30"/>
                                <Setter Property="Foreground" Value="#CCCCCC"/>
                                <Setter Property="Padding" Value="10,4"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TabItem">
                                            <Border x:Name="TabBorder" Background="{TemplateBinding Background}"
                                                    Padding="{TemplateBinding Padding}" Margin="0,0,2,0">
                                                <ContentPresenter ContentSource="Header"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="TabBorder" Property="Background" Value="#FF3E3E42"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TabControl.Resources>

                        <!-- Playlist Options -->
                        <TabItem Header="Playlist">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                                <StackPanel>
                                    <CheckBox x:Name="ChkAutoAdvance" Content="Auto-advance after take"
                                              Foreground="White" Margin="0,4"
                                              Checked="AutoAdvance_Changed" Unchecked="AutoAdvance_Changed"/>
                                    <CheckBox x:Name="ChkLoop" Content="Loop playlist"
                                              Foreground="White" Margin="0,4"
                                              Checked="Loop_Changed" Unchecked="Loop_Changed"/>
                                    <Separator Margin="0,8" Background="{StaticResource BorderDark}"/>
                                    <Button Content="Reset All Items" Click="ResetPlaylist_Click"
                                            Padding="8,4" Margin="0,4"/>
                                    <Button Content="Clear Playlist" Click="ClearPlaylist_Click"
                                            Padding="8,4" Margin="0,4"/>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Engine Options -->
                        <TabItem Header="Output">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="8">
                                <StackPanel>
                                    <TextBlock Text="Spout Output" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                    <CheckBox x:Name="ChkSpoutEnabled" Content="Enable Spout output"
                                              Foreground="White" Margin="0,4"
                                              Checked="SpoutEnabled_Changed" Unchecked="SpoutEnabled_Changed"/>
                                    <DockPanel Margin="0,8,0,4">
                                        <TextBlock Text="Sender name:" Foreground="{StaticResource FgSecondary}"
                                                   Width="90" VerticalAlignment="Center"/>
                                        <TextBox x:Name="TxtSpoutName" Text="DaroPlayout"
                                                 Background="#FF2D2D30" Foreground="White" Padding="4"
                                                 LostFocus="SpoutName_LostFocus"/>
                                    </DockPanel>
                                    <Separator Margin="0,12" Background="{StaticResource BorderDark}"/>
                                    <TextBlock Text="Resolution" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                    <TextBlock Text="1920 x 1080 @ 50fps" Foreground="{StaticResource FgSecondary}"/>
                                </StackPanel>
                            </ScrollViewer>
                        </TabItem>

                        <!-- Takes -->
                        <TabItem Header="Takes" x:Name="TabTakes">
                            <DockPanel>
                                <Border DockPanel.Dock="Top" Background="{StaticResource BgHeader}" Padding="8,4">
                                    <TextBlock x:Name="TxtTakesTemplate" Text="No template loaded"
                                               Foreground="{StaticResource FgSecondary}" FontSize="11"/>
                                </Border>
                                <ListBox x:Name="TakesList" Background="Transparent" BorderThickness="0"
                                         SelectionChanged="TakesList_SelectionChanged">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="8,4" Margin="2" Background="#FF2D2D30" CornerRadius="3">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Name}" Foreground="White"/>
                                                    <TextBlock Text=" - " Foreground="{StaticResource FgSecondary}"/>
                                                    <TextBlock Text="{Binding Duration, StringFormat={}{0}f}"
                                                               Foreground="{StaticResource FgSecondary}"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </DockPanel>
                        </TabItem>
                    </TabControl>
                </Border>
            </Grid>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                          Background="{StaticResource BorderDark}" Cursor="SizeWE"/>

            <!-- RIGHT PANEL: PLAYLIST -->
            <Border Grid.Column="2" Background="{StaticResource BgPanel}">
                <DockPanel>
                    <!-- Playlist Header -->
                    <Border DockPanel.Dock="Top" Background="{StaticResource BgHeader}" Padding="8,6">
                        <DockPanel>
                            <TextBlock Text="PLAYLIST" Style="{StaticResource HeaderStyle}"/>
                            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                                <Button Content="â–²" Width="28" Height="28" Margin="0,0,2,0"
                                        Click="PlaylistMoveUp_Click" ToolTip="Move Up"/>
                                <Button Content="â–¼" Width="28" Height="28" Margin="0,0,2,0"
                                        Click="PlaylistMoveDown_Click" ToolTip="Move Down"/>
                                <Button Content="âœ•" Width="28" Height="28" Margin="0,0,8,0"
                                        Click="PlaylistRemove_Click" ToolTip="Remove"/>
                                <Button Content="Duplicate" Padding="8,4" Margin="0,0,4,0"
                                        Click="PlaylistDuplicate_Click" ToolTip="Duplicate selected"/>
                                <Button Content="Edit" Padding="8,4"
                                        Click="PlaylistEdit_Click" ToolTip="Edit selected item"/>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <!-- Playlist Items -->
                    <ListBox x:Name="PlaylistItems" Background="Transparent" BorderThickness="0"
                             SelectionChanged="PlaylistItems_SelectionChanged"
                             MouseDoubleClick="PlaylistItems_MouseDoubleClick">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="12,8" Margin="4" CornerRadius="4"
                                        Background="#FF2D2D30" BorderThickness="3" MinHeight="50">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="BorderBrush" Value="Transparent"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Cued">
                                                    <Setter Property="BorderBrush" Value="{StaticResource AccentOrange}"/>
                                                    <Setter Property="Background" Value="#FF3D3520"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="OnAir">
                                                    <Setter Property="BorderBrush" Value="{StaticResource PlayColor}"/>
                                                    <Setter Property="Background" Value="#FF2A4A2A"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Done">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="40"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Order number -->
                                        <TextBlock Grid.Column="0" Text="{Binding Order}"
                                                   FontSize="18" FontWeight="Bold"
                                                   Foreground="{StaticResource FgSecondary}"
                                                   VerticalAlignment="Center"/>

                                        <!-- Item info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" Foreground="White"
                                                       FontSize="14" FontWeight="SemiBold"/>
                                            <TextBlock Foreground="{StaticResource FgSecondary}" FontSize="11">
                                                <Run Text="{Binding TemplateName, Mode=OneWay}"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- Status -->
                                        <Border Grid.Column="2" CornerRadius="3" Padding="8,4"
                                                VerticalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Cued">
                                                            <Setter Property="Background" Value="{StaticResource AccentOrange}"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="OnAir">
                                                            <Setter Property="Background" Value="{StaticResource PlayColor}"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock FontSize="11" FontWeight="Bold" Foreground="White">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value=""/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Status}" Value="Cued">
                                                                <Setter Property="Text" Value="CUED"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="OnAir">
                                                                <Setter Property="Text" Value="ON AIR"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>
        </Grid>

        <!-- STATUS BAR -->
        <Border Grid.Row="2" Background="{StaticResource BgHeader}" Padding="8,4">
            <DockPanel>
                <TextBlock DockPanel.Dock="Left" x:Name="TxtStatus" Text="Ready"
                           Foreground="{StaticResource FgSecondary}" FontSize="11"/>
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <Border Background="#FF2D5A2D" CornerRadius="3" Padding="6,2" Margin="8,0">
                        <TextBlock x:Name="TxtMosartStatus" Text="Mosart: Port 5555"
                                   Foreground="#FF7FBF7F" FontSize="10" FontWeight="SemiBold"/>
                    </Border>
                    <TextBlock x:Name="TxtPlaylistCount" Text="0 items"
                               Foreground="{StaticResource FgSecondary}" FontSize="11"/>
                </StackPanel>
                <TextBlock/>
            </DockPanel>
        </Border>
    </Grid>
</Window>
